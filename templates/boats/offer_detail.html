{% extends 'base.html' %}

{% block title %}Оффер {{ offer.uuid }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <div class="mb-8">
            <a href="{% url 'offers_list' %}" class="btn btn-ghost btn-sm">
                <i class="fas fa-arrow-left"></i> Назад к списку
            </a>
        </div>

        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h1 class="text-3xl font-bold">{{ offer.title }}</h1>
                        <p class="text-base-content/70 mt-2">UUID: <code class="text-sm">{{ offer.uuid }}</code></p>
                    </div>
                    {% if offer.is_active %}
                        <div class="badge badge-success badge-lg">Активен</div>
                    {% else %}
                        <div class="badge badge-error badge-lg">Неактивен</div>
                    {% endif %}
                </div>

                <div class="divider"></div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold mb-2"><i class="fas fa-calendar text-primary"></i> Даты</h3>
                        <p>Заезд: <strong>{{ offer.check_in|date:"d.m.Y" }}</strong></p>
                        <p>Выезд: <strong>{{ offer.check_out|date:"d.m.Y" }}</strong></p>
                    </div>

                    <div>
                        <h3 class="font-bold mb-2"><i class="fas fa-money-bill text-primary"></i> Цены</h3>
                        <p>Итого: <strong>{{ offer.total_price|floatformat:0 }} {{ offer.currency }}</strong></p>
                        {% if offer.original_price %}
                        <p>Было: <del>{{ offer.original_price|floatformat:0 }} {{ offer.currency }}</del></p>
                        {% endif %}
                        {% if offer.discount > 0 %}
                        <p class="text-success">Скидка: {{ offer.discount|floatformat:0 }} {{ offer.currency }}</p>
                        {% endif %}
                    </div>
                </div>

                <div class="divider"></div>

                <div>
                    <h3 class="font-bold mb-2"><i class="fas fa-ship text-primary"></i> Информация о яхте</h3>
                    {% with boat_info=offer.boat_data.boat_info %}
                    <ul class="space-y-1">
                        {% if boat_info.title %}
                        <li>Название: <strong>{{ boat_info.title }}</strong></li>
                        {% endif %}
                        {% if boat_info.location %}
                        <li>Локация: <strong>{{ boat_info.location }}</strong></li>
                        {% endif %}
                        {% if boat_info.marina %}
                        <li>Марина: <strong>{{ boat_info.marina }}</strong></li>
                        {% endif %}
                        {% if boat_info.manufacturer %}
                        <li>Производитель: <strong>{{ boat_info.manufacturer }}</strong></li>
                        {% endif %}
                        {% if boat_info.year %}
                        <li>Год: <strong>{{ boat_info.year }}</strong></li>
                        {% endif %}
                    </ul>
                    {% endwith %}
                </div>

                {% if offer.description %}
                <div class="divider"></div>
                <div>
                    <h3 class="font-bold mb-2"><i class="fas fa-align-left text-primary"></i> Описание</h3>
                    <p>{{ offer.description }}</p>
                </div>
                {% endif %}

                {% if can_view_internal_notes and offer.notes %}
                <div class="divider"></div>
                <div>
                    <h3 class="font-bold mb-2"><i class="fas fa-sticky-note text-primary"></i> Внутренние заметки</h3>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <span>{{ offer.notes }}</span>
                    </div>
                </div>
                {% endif %}

                <div class="divider"></div>

                <div class="stats shadow">
                    <div class="stat">
                        <div class="stat-figure text-primary">
                            <i class="fas fa-eye text-3xl"></i>
                        </div>
                        <div class="stat-title">Просмотров</div>
                        <div class="stat-value text-primary">{{ offer.views_count }}</div>
                    </div>
                    
                    <div class="stat">
                        <div class="stat-figure text-secondary">
                            <i class="fas fa-clock text-3xl"></i>
                        </div>
                        <div class="stat-title">Создан</div>
                        <div class="stat-value text-secondary text-lg">{{ offer.created_at|date:"d.m.Y" }}</div>
                        <div class="stat-desc">{{ offer.created_at|date:"H:i" }}</div>
                    </div>
                </div>

                <div class="divider"></div>

                <div>
                    <h3 class="font-bold mb-2"><i class="fas fa-link text-primary"></i> Ссылки</h3>
                    <div class="space-y-2">
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                class="input input-bordered input-sm flex-1" 
                                value="{{ request.scheme }}://{{ request.get_host }}{% url 'offer_view' offer.uuid %}" 
                                id="offerUrl" 
                                readonly>
                            <button class="btn btn-sm btn-primary" x-data @click="copyUrl()">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <a href="{{ offer.source_url }}" target="_blank" class="btn btn-sm btn-outline">
                            <i class="fas fa-external-link-alt"></i> Открыть источник
                        </a>
                    </div>
                </div>

                <div class="card-actions justify-end mt-6">
                    <a href="{% url 'offer_view' offer.uuid %}" class="btn btn-primary" target="_blank">
                        <i class="fas fa-eye"></i> Превью
                    </a>
                    <form method="post" action="{% url 'delete_offer' offer.uuid %}" x-data @submit.prevent="if (confirm('Удалить оффер?')) $el.submit()">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-error">
                            <i class="fas fa-trash"></i> Удалить
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyUrl() {
    const input = document.getElementById('offerUrl');
    input.select();
    navigator.clipboard.writeText(input.value);
    alert('Ссылка скопирована!');
}
</script>
{% endblock %}
